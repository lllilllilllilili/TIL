## Compare And Swap
- 동시성 처리 방법
### 줄여서 CAS 방식 
- ConcurrentHashMap는 읽기 및 쓰기 연산은 CAS 기반으로 되어 있다. 예를들어, 특정 버킷(슬롯)에 값을 삽입할 때 이미 해당 슬롯에 데이터가 없는 경우 CAS 연산으로 빠르게 삽입된다. 

### CAS 방식
- CAS는 비교하고 교체하는 연산이다. 보통 세 가지 값을 인자로 받는다. 
- 메모리 위치, 기대값, 바꾸고자 하는 값
- 먼저 메모리 위치의 현재 값을 읽어온뒤 읽은 값이 기대값과 같은지 비교한다. 
    - 이때 값이 같으면 새로운 값으로 교체한다. 
    - 값이 다르면 아무것도 하지 않고 실패를 반환함 
    - 여기서 Lock 을 사용하지 않고 스레드 간 경합을 처리할 수 있기 때문에 성능에 유리하다. 
- 간단한 원자적인 연산에 적합하다. 

### CAS로 처리하기 어려운 경우
- 여러 메모리 위치나 복합적인 연산(리스트에서 여러 값을 수정해야 하는경우) CAS로 처리하기 어렵다. 이런 경우에는 synchronized 블록을 사용해 락을 걸고 일관성을 보장해야 한다. 
- ABA 문제
    - 스레드가 값이 변경되었는지 확인할 때 기대값이 잠깐 다른 값으로 바뀌었다가 다시 원래 값으로 돌아온 경우에 CAS가 성공한 것으로 간주됀다. 
- 연속적인 충돌
    - 여러 스레드가 동일한 메모리 위치에 대해 동시에 CAS 연산을 시도할 경우, 충돌이 발생할 수 있다. 충돌이 자주 발생하게 되면 CAS는 반복적으로 실패하게 되고, 성능 저하로 이어질 수 있다. 

### ABA 문제
- 동시성 문제중 하나이다. 
- 스레드1이 특정 메모리 위치의 값을 읽는다. 그때 값이 A라고 해보자.
- 스레드1은 그 값을 A로 기억해두고 그 사이에 다른 작업을 하거나 어떤 처리를 했다고 가정하자. 
- 스레드2가 해당 메모리 위치를 변경한다. 스레드2가 값을 A에서 B로 바꾸고 이후 다시 B에서 A로 변경한다. 
- 스레드1이 작업을 마치고 다시 그 값을 확인할 때 여전히 값은 A가 됀다. 스레드 1은 자신이 처음 읽었던 값이 여전히 A라고 생각하고 CAS연산을 통해 값을 변경하려 한다. 
- 결론적으로 스레드1은 A에서 C로 값을 바꾸려고 시도하는데, 스레드2가 값을 바꿨다는 사실을 모르고 그대로 CAS연산이 성공하게 됀다. 
- 데이터 일관성이 꺠질 수 있는 문제가 됀다. 값이 단순히 바뀌었다가 다시 원래 값으로 돌아왔음에도 불구하고 그 중간의 변경사항을 인식하지 못하게 되어 잘못된 동작이 발생하게 된다. 

## ABA 문제 해결 방법 
- Double-Compare-And-SWap 
    - 두 개의 값을 한꺼번에 비교하고 교환하는 연산이다. 값과 상태를 함께 비교하여 ABA 문제를 줄 일 수 있다. 