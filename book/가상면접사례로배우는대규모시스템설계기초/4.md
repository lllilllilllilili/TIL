## 처리율 제한 장치
특정 시간 동안 네트워크를 통해 전송되는 데이터의 양이나 서비스에 대한 요청 수를 제한하는 장치나 소프트웨어를 의미한다.

## API 처리 장치의 장점
- Denial of Service 공격 방지
- DOS 라고 하며 인터넷이나 네트워크에 연결된 서비스나 서버를 대상으로 공격자가 정상적인 사용자나 시스템이 서비스를 이용하지 못하도록 의도적으로 과부하를 일으키는 사이버 공격을 방지한다. 
- 서비스에 대한 요청 수를 제한하기 때문에 비용이 절감될 수 있다.
- 서버 과부하를 막는 목적도 있다.
## 시스템 설계 4단계 접근법을 적용
- 1단계 문제 이해 및 설계 범위 확정 
- 요구사항 
    - 설정되어 있는 처리율을 초과하는 요청은 제한한다. 
    - HTTP 응답시간에 나쁜 영향을 주면 안되니 낮은 응답시간을 전제로 한다.
    - 적은 메모리
    - 하나의 처리율 제한 장치에서 여러 서버 또는 프로세스에 공유할 수 있어야 한다.  
    - 요청이 제한되었을 때 제한된 이유를 사용자에게 분명하게 해야 한다. 
    - 제한 장치에 장애가 발생하더라도 전체 시스템에 영향을 주면 안된다. 
## 2단계 개략적 설계안 제시 및 동의 구하기
 - 처리율 장치의 위치에 대한 고민
    - Client
        - 위변조가 가능해서 여기에는 추천하지 않는다. 
        - 서버로 보내는 요청 수를 스스로 제한할 수 있다. 
    - Server
        - 중앙에서 관리한다.
        - 서버는 요청 수를 제한할 수 있다.
    - Middleware
        - Client 와 Server 사이에 위치한다. 여기서 네트워크 요청과 데이터를 중계한다. 
        - MSA 인 경우는 처리율 제한 장치를 API Gateway에 구현한다. 
        - API Gateway 의 역할은 보통 처리율 제한, 사용자 인증, IP White List 관리 등 이 있다.
        - 처리율 제한장치에 사용될 수 있는 알고리즘

## 토큰 버킷 알고리즘 
- 토큰을 주기적으로 채워진다.
- 각 요청이 처리될 때 마다 하나의 토큰을 사용한다. 
- 토근이 없으면 해당 요청은 버려진다. 
- AWS 와 같은 기업에서도 API Gateway 를 생성할 때 보편적으로 사용하는 알고리즘 이라는 사실을 알 수 있다. 

- 시스템 처리율이 제한되어 있는 상황에서는 초당 발생한 요청은 하나의 버킷을 공유해야 한다. 
위와 같이 채택되어 있는 이유는 장단점이 있다.

- 장점 
    - 구현이 쉽다. 
    - 메모리 사용이 효율적이다.
    - 초당 발생되는 트래픽도 잘 처리될 수 있다. (버킷이 공유)
- 단점
    - 버킷 Size, 토큰 공급률 두 개의 인자로 필요로 하는 알고리즘이기 때문에 적절한 튜닝 하는것이 어렵다.
    - Q&A -> 이 알고리즘이 뭐고 왜 버킷 사이즈와 토큰 공급률이 필요한거지? 각 내용에 대한 용어 정의가 필요해보인다. 
 

